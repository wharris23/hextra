{{ $filename := .filename | default "" -}}
{{ $base_url := .base_url | default "" -}}
{{ $full_url := .full_url | default "" -}}
{{ $lang := .lang | default "" }}
{{ $content := .content }}
{{ $options := .options | default (dict) }}

{{- if $filename -}}
  <div class="hextra-code-filename not-prose" dir="auto">
    {{- $file_url := $filename -}} <!-- default to just filename -->

    {{- if $full_url -}}
      {{- $file_url = $full_url -}}
    {{- else if or (strings.HasPrefix $filename "http://") (strings.HasPrefix $filename "https://") -}}
      {{- $file_url = $filename -}}
    {{- else if $base_url -}}
      {{- $base_url = strings.TrimSuffix "/" $base_url -}}
      {{- $filename = strings.TrimPrefix "/" $filename -}}
      {{- $file_url = urls.JoinPath $base_url $filename -}}
    {{- end -}}


      <a class="hx:no-underline hx:inline-flex hx:items-center hx:gap-1" href="{{ $file_url }}" target="_blank" rel="noopener noreferrer">
          <span>{{- $filename -}}</span>
          {{- partial "utils/icon" (dict "name" "external-link" "attributes" "height=1em") -}}
      </a>
    {{- else -}}
      {{- $filename -}}
    {{- end -}}
  </div>
{{- end -}}

{{- if transform.CanHighlight $lang -}}
  <div>{{- highlight $content $lang $options -}}</div>
{{- else -}}
  <div><pre><code>{{ $content }}</code></pre></div>
{{- end -}}
